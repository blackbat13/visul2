<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Sorting algorithms</title>
    <link rel="stylesheet" type="text/css" href="node_modules/bootstrap/dist/css/bootstrap.min.css"/>
    <link rel="stylesheet" type="text/css" href="assets/css/main.css"/>
    <link rel="stylesheet" type="text/css" href="assets/css/sorting.css"/>
</head>
<body>
<div class="container">
    <div class="row">
        <div class="col-12 visul-container" id="visul-container">
            <div class="sorting-block">
                <span class="sorting-number">10</span>
            </div>
        </div>
    </div>
</div>

<script src="node_modules/jquery/dist/jquery.min.js"></script>
<script src="node_modules/bootstrap/dist/js/bootstrap.min.js"></script>
<script src="node_modules/animejs/lib/anime.min.js"></script>
<script>
    $(document).ready(function () {
        let array = [];
        let $visulContainer = $("#visul-container");
        let blockWidth = 50;
        let sortingBlocks = [];
        let firstIndex = 0;
        let secondIndex = 0;
        let completedAnimation = 0;

        function prepareRandomArray(n) {
            array = [];
            for (let i = 0; i < n; i++) {
                array.push(Math.floor(Math.random() * 15) + 1);
            }
        }

        function showArray() {
            let containerWidth = $visulContainer.width();
            let left = Math.floor((containerWidth - array.length * blockWidth) / 2);
            $visulContainer.empty();
            sortingBlocks = [];
            for (let i = 0; i < array.length; i++) {
                sortingBlocks.push(prepareSortingBlock(array[i], left, i));
                $visulContainer.append(sortingBlocks[i]);
                left += blockWidth;
            }
        }

        function prepareSortingBlock(number, left, orderId) {
            let $sortingBlock = $("<div></div>");
            $sortingBlock.addClass("sorting-block");
            $sortingBlock.css("height", (number * 25).toString() + "px");
            $sortingBlock.css("width", blockWidth.toString() + "px");
            $sortingBlock.css("left", left.toString() + "px");
            $sortingBlock.attr("id", "sorting-block-" + orderId.toString());

            $sortingBlock.append(prepareSortingNumber(number));
            return $sortingBlock;
        }

        function prepareSortingNumber(number) {
            let $sortingNumber = $("<span></span>")
            $sortingNumber.addClass("sorting-number");
            $sortingNumber.text(number.toString());
            return $sortingNumber;
        }

        function animateSorting() {
            if(completedAnimation > 0) {
                requestAnimationFrame(animateSorting);
                return;
            }

            animateBubbleSort();
            requestAnimationFrame(animateSorting);
        }

        function animateBubbleSort() {
            let tmp;
            while (firstIndex < array.length) {
                while (secondIndex < array.length - firstIndex - 1) {
                    if (array[secondIndex] > array[secondIndex + 1]) {
                        animateSwap(secondIndex, secondIndex+1);
                        tmp = array[secondIndex];
                        array[secondIndex] = array[secondIndex + 1];
                        array[secondIndex + 1] = tmp;

                        tmp = sortingBlocks[secondIndex];
                        sortingBlocks[secondIndex] = sortingBlocks[secondIndex + 1];
                        sortingBlocks[secondIndex + 1] = tmp;
                    }

                    secondIndex++;
                    return;
                }

                secondIndex = 0;
                firstIndex++;
                highlightBlock(array.length - firstIndex);
            }
        }

        function highlightBlock(i) {
            anime({
                targets: '#' + sortingBlocks[i].attr("id"),
                backgroundColor: '#ffd700',
            });
        }

        function animateSwap(i, j) {
            completedAnimation = 2;

            anime({
                targets: '#' + sortingBlocks[i].attr("id"),
                left: sortingBlocks[j].css("left"),
                easing: 'easeInOutQuad',
                complete: function (anim) {
                    completedAnimation--;
                }
            });

            anime({
                targets: '#' + sortingBlocks[j].attr("id"),
                left: sortingBlocks[i].css("left"),
                easing: 'easeInOutQuad',
                complete: function (anim) {
                    completedAnimation--;
                }
            });
        }

        prepareRandomArray(10);
        showArray();
        requestAnimationFrame(animateSorting);

    });
</script>
</body>
</html>
